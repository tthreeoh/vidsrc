<!-- <!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style> 
body {
    background-color: black;
    color: white;
}
#submits {
    background-color: white;
    color: black;
    padding: 10px;
    border: 1px solid black;
    border-radius: 5px;
}
#moviesubmitbox {
    background-color: white;
    color: black;
    padding: 10px;
    border: 1px solid black;
    border-radius: 5px;
}
#showsubmitbox {
    background-color: white;
    color: black;
    padding: 10px;
    border: 1px solid black;
    border-radius: 5px;
}
#demo {
    background-color: white;
    color: black;
    padding: 10px;
    border: 1px solid black;
    border-radius: 5px;
}
#videobox {
    background-color: white;
    color: black;
    padding: 10px;
    border: 1px solid black;
    border-radius: 5px;
}

</style>
</head>
<body>

<div id="submits" style="position:absolute; top:20%; right:80%; width:auto; height:auto">
    <div id="apikeybox">
        OMDB APIkey:<input type="text" id="apikey" value="omdb api key " style="width:80px"><br>
    </div>

    <div id="moviesubmitbox">
        <input type="text" id="movietitle" value="Barbie ">
        <button id="movieBtn">movie</button><br>
    </div>
    <div id="showsubmitbox" >
        <input type="text" id="showtitle" value="" >
        <input type="text" id="season" style="width: 20px;" value="">
        <input type="text" id="episode" style="width: 20px;" value="">
        <button id="showBtn">show</button>
    </div>
    <p id="demo">
    Type a Title and Search for a movie or show
    </p>
</div>
<div id="videobox" style="position:absolute; top:0; left:20%; width:78%; height:96%">
<iframe src="about:blank" id="iframeResult" style='width:100%;height:100%;border:none; allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true' scrolling='no' frameborder='0' allow='autoplay; fullscreen; vr'></iframe>
</div>

<script> 

function getJson(url) {
    return fetch(url)
    .then(function(response) {
        return response.json();
    })
    .then(function(myJson) {
        return myJson;
    });
}
function get_api_key() {
    return document.getElementById("apikey").value;
}

document.getElementById("movieBtn").addEventListener("click", function() {
    //make json request to ombd
    let title = document.getElementById("movietitle").value;
    if (title == "") {
        return;
    }
    title = title.replace(/ /g,"+");
    var url = "http://www.omdbapi.com/?t="+title+"&apikey="+get_api_key()+"&r=json&plot=full";
    //make json request to ombd
    var json = getJson(url);
    json.then(function(result) {
        document.getElementById("demo").innerHTML = result.Title + " " + result.Year + " " + result.Rated + " Runtime:" + result.Runtime + "<br><img src='"+result.Poster+"'></img><br>IMDB rating :" + result.imdbRating + "<br>Plot:<br>" + result.Plot;
        document.getElementById("iframeResult").src = "https://vidsrc.me/embed/"+result.imdbID;

    });
    document.getElementById("showtitle").value="";
    document.getElementById("season").value="";
    document.getElementById("episode").value="";
});
document.getElementById("showBtn").addEventListener("click", function() {
    document.getElementById("movietitle").value="";
    let showtitle = document.getElementById("showtitle").value;
    let season = document.getElementById("season").value;
    let episode = document.getElementById("episode").value;
    if (season == "" || season == "0"){
        season = "1";
        document.getElementById("season").value="1";
    }
    if (episode == "" || episode == "0"){
        episode = "1";
        document.getElementById("episode").value="1";
    }
    showtitle = showtitle.replace(/ /g,"+");
    var url = "http://www.omdbapi.com/?t="+showtitle+"&apikey="+get_api_key()+"&r=json&type=series";
    //make json request to ombd
    var json = getJson(url);
    json.then(function(result) {
        document.getElementById("demo").innerHTML = result.Title + " " + result.Year + " " + result.Rated + " Runtime:" + result.Runtime + "<br><img src='"+result.Poster+"'></img><br>IMDB rating :" + result.imdbRating + "<br>Plot:<br>" + result.Plot;
        text = "https://vidsrc.me/embed/tv?imdb="+result.imdbID+"&season="+season+"&episode="+episode
        document.getElementById("iframeResult").src = text;

    });
});

</script>

</body>
</html>
 -->


 <!-- <!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        background-color: black;
        color: white;
        margin: 0;
        font-family: Arial, sans-serif;
    }
    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100%;
    }
    .info-pane {
        background-color: #222;
        color: white;
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 600px;
        text-align: center;
        box-sizing: border-box;
    }
    .info-pane img {
        max-width: 100%;
        height: auto;
    }
    .info-pane h2 {
        margin: 10px 0;
    }
    .info-pane p {
        margin: 10px 0;
        font-size: 14px;
    }
    .info-pane strong {
        font-size: 18px;
    }
    .button {
        background-color: #444;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
        display: inline-block;
        min-width: 150px;
    }
    .button:hover {
        background-color: #666;
    }
    #timer {
        font-size: 20px;
        margin: 15px 0;
        color: #ffcc00;
        font-weight: bold;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="info-pane" id="demo">
            Loading movie information...
            <div id="timer"></div>
            <button class="button" id="playNowBtn">Play Now</button>
        </div>
    </div>

<script>
window.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const imdbID = params.get("imdb");
    const embedUrl = params.get("embed");
    
    let delayTime = 10; // Delay in seconds
    let countdownTimer;

    // Show movie info if IMDB ID is present
    if (imdbID) {
        fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=5aa3307`)
            .then(response => response.json())
            .then(result => {
                document.getElementById("demo").innerHTML = `
                    <h2>${result.Title} (${result.Year})</h2>
                    <p><strong>Rated:</strong> ${result.Rated}</p>
                    <p><strong>Runtime:</strong> ${result.Runtime}</p>
                    <p><strong>IMDB Rating:</strong> ${result.imdbRating}</p>
                    <img src="${result.Poster}" alt="Poster">
                    <p><strong>Plot:</strong></p>
                    <p>${result.Plot}</p>
                    <div id="timer"></div>
                    <button class="button" id="playNowBtn">Play Now</button>
                `;
                
                // Re-attach event listener to the new button
                const playNowBtn = document.getElementById("playNowBtn");
                playNowBtn.addEventListener("click", () => {
                    clearInterval(countdownTimer); // Stop the countdown
                    playVideo(); // Play video immediately
                });
                
                startCountdown(); // Start countdown after loading data
            })
            .catch(error => {
                console.error('Error fetching movie data:', error);
                document.getElementById("demo").textContent = "Error loading movie information.";
            });
    } else {
        document.getElementById("demo").textContent = "No IMDb ID provided.";
    }

    // Countdown Timer
    const startCountdown = () => {
        let remainingTime = delayTime;
        const timerDisplay = document.getElementById("timer");
        const playNowBtn = document.getElementById("playNowBtn");
        
        // Update button text initially
        updateButtonText(remainingTime, playNowBtn);
        
        countdownTimer = setInterval(() => {
            if (remainingTime <= 0) {
                clearInterval(countdownTimer);
                timerDisplay.textContent = "Starting movie...";
                playNowBtn.textContent = "Loading...";
                playVideo();
            } else {
                remainingTime--;
                updateButtonText(remainingTime, playNowBtn);
            }
        }, 1000);
    };

    // Update button text with countdown
    const updateButtonText = (timeLeft, button) => {
        const timerDisplay = document.getElementById("timer");
        if (timeLeft > 0) {
            button.textContent = `Play Now (${timeLeft}s)`;
            timerDisplay.textContent = `Auto-playing in ${timeLeft} seconds...`;
        } else {
            button.textContent = "Loading...";
            timerDisplay.textContent = "Starting movie...";
        }
    };

    // Play the video by redirecting to the extension player
    const playVideo = () => {
        if (embedUrl) {
            const extUrl = `chrome-extension://emnphkkblegpebimobpbekeedfgemhof/player.html#${embedUrl}`;
            window.location.href = extUrl; // Redirect to the player
        } else {
            document.getElementById("timer").textContent = "No embed URL provided.";
        }
    };
});
</script>
</body>
</html> -->



<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        background-color: black;
        color: white;
        margin: 0;
        font-family: Arial, sans-serif;
    }
    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100%;
    }
    .info-pane {
        background-color: #222;
        color: white;
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 600px;
        text-align: center;
        box-sizing: border-box;
    }
    .info-pane img {
        max-width: 100%;
        height: auto;
    }
    .info-pane h2 {
        margin: 10px 0;
    }
    .info-pane p {
        margin: 10px 0;
        font-size: 14px;
    }
    .info-pane strong {
        font-size: 18px;
    }
    .button {
        background-color: #444;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
        display: inline-block;
        min-width: 150px;
    }
    .button:hover {
        background-color: #666;
    }
    #timer {
        font-size: 20px;
        margin: 15px 0;
        color: #ffcc00;
        font-weight: bold;
    }
    #keyInputContainer {
        margin-bottom: 20px;
    }
    #apiKeyInput {
        padding: 10px;
        font-size: 16px;
        width: 80%;
        margin-bottom: 10px;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="info-pane" id="demo">
            Loading movie information...
            <div id="keyInputContainer" style="display: none;">
                <input type="text" id="apiKeyInput" placeholder="Enter your OMDb API key">
                <button class="button" id="saveApiKeyBtn">Save API Key</button>
            </div>
            <div id="timer"></div>
            <button class="button" id="playNowBtn">Play Now</button>
        </div>
    </div>

<script>
window.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const imdbID = params.get("imdb");
    const embedUrl = params.get("embed");
    const apiKeyFromURL = params.get("key");

    let delayTime = 5;
    let countdownTimer;
    let apiKey = localStorage.getItem("omdbApiKey");

    // If key is passed via URL, use and store it
    if (apiKeyFromURL) {
        apiKey = apiKeyFromURL;
        localStorage.setItem("omdbApiKey", apiKey);
    }

    // If no key exists, prompt for input
    if (!apiKey) {
        document.getElementById("keyInputContainer").style.display = "block";
        document.getElementById("saveApiKeyBtn").addEventListener("click", () => {
            const inputKey = document.getElementById("apiKeyInput").value.trim();
            if (inputKey) {
                localStorage.setItem("omdbApiKey", inputKey);
                location.reload(); // reload with new key
            }
        });
        return; // stop execution until key is set
    }

    if (imdbID) {
        fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=${apiKey}`)
            .then(response => response.json())
            .then(result => {
                if (result.Response === "False") {
                    throw new Error(result.Error);
                }
                document.getElementById("demo").innerHTML = `
                    <h2>${result.Title} (${result.Year})</h2>
                    <p><strong>Rated:</strong> ${result.Rated}</p>
                    <p><strong>Runtime:</strong> ${result.Runtime}</p>
                    <p><strong>IMDB Rating:</strong> ${result.imdbRating}</p>
                    <img src="${result.Poster}" alt="Poster">
                    <p><strong>Plot:</strong></p>
                    <p>${result.Plot}</p>
                    <div id="timer"></div>
                    <button class="button" id="playNowBtn">Play Now</button>
                `;

                document.getElementById("playNowBtn").addEventListener("click", () => {
                    clearInterval(countdownTimer);
                    playVideo();
                });

                startCountdown();
            })
            .catch(error => {
                console.error("Error fetching movie data:", error);
                document.getElementById("demo").textContent = "Error: " + error.message;
            });
    } else {
        document.getElementById("demo").textContent = "No IMDb ID provided.";
    }

    function startCountdown() {
        let remainingTime = delayTime;
        const timerDisplay = document.getElementById("timer");
        const playNowBtn = document.getElementById("playNowBtn");

        updateButtonText(remainingTime, playNowBtn);

        countdownTimer = setInterval(() => {
            if (remainingTime <= 0) {
                clearInterval(countdownTimer);
                timerDisplay.textContent = "Starting movie...";
                playNowBtn.textContent = "Loading...";
                playVideo();
            } else {
                remainingTime--;
                updateButtonText(remainingTime, playNowBtn);
            }
        }, 1000);
    }

    function updateButtonText(timeLeft, button) {
        const timerDisplay = document.getElementById("timer");
        if (timeLeft > 0) {
            button.textContent = `Play Now (${timeLeft}s)`;
            timerDisplay.textContent = `Auto-playing in ${timeLeft}`;
        } else {
            button.textContent = "Loading...";
            timerDisplay.textContent = "Starting movie...";
        }
    }

    function playVideo() {
        if (embedUrl) {
            const extUrl = `chrome-extension://emnphkkblegpebimobpbekeedfgemhof/player.html#${embedUrl}`;
            window.location.href = extUrl;
        } else {
            document.getElementById("timer").textContent = "No embed URL provided.";
        }
    }
});
</script>
</body>
</html>
